{% include "header.html" %}

<body class="{% if current_user.is_authenticated %}has-sidebar{% else %}no-sidebar{% endif %}">
    <main>

        {% if current_user.is_authenticated %}
        <!-- SIDEBAR -->
        <div class="sidebar shadow">
            <div class="p-4 border-bottom">
                <div class="d-flex align-items-center gap-3">
                    <div class="d-flex align-items-center justify-content-center bg-primary rounded"
                        style="width: 40px; height: 40px;">
                        <i class="ri-book-line text-white fs-4"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-0">BiblioTech</h5>
                        <small class="text-muted">Dashboard</small>
                    </div>
                </div>
            </div>

            <nav class="mt-3 px-3 d-flex flex-column gap-2">

                <!-- ✅ Visible pour TOUS -->
                <a href="/dashboard" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2 
            {% if title == 'Dashboard' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-dashboard-line"></i> Tableau de bord
                </a>

                <!-- ✅ Visible UNIQUEMENT POUR ADMIN -->
                {% if current_user.role == 'admin' %}

                <a href="/dashboard/adherents" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2 
            {% if title == 'Adhérents' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-user-line"></i> Adhérents
                </a>

                <a href="/dashboard/emprunts" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2 
            {% if title == 'Emprunts' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-bookmark-line"></i> Emprunts
                </a>

                <!-- ✅ ✅ NOUVEAU : MENU LIVRES -->
                <a href="/dashboard/livres" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2
            {% if title == 'Livres' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-book-2-line"></i> Livres
                </a>

                {% endif %}

                <!-- ✅ Visible pour TOUS -->
                <a href="/dashboard/statistiques" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2 
            {% if title == 'Statistiques' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-bar-chart-line"></i> Statistiques
                </a>

                <a href="/dashboard/parametres" class="btn w-100 text-start d-flex align-items-center gap-3 px-3 py-2 
            {% if title == 'Paramètres' %}bg-primary text-white{% else %}bg-light text-dark{% endif %}">
                    <i class="ri-settings-line"></i> Paramètres
                </a>

                <hr>

                <a href="{{ url_for('logout') }}"
                    class="btn w-100 text-danger text-start d-flex align-items-center gap-3 px-3 py-2">
                    <i class="ri-logout-box-line"></i> Déconnexion
                </a>

            </nav>
        </div>
        {% endif %}

        <!-- CONTENT -->
        <div class="content {% if not current_user.is_authenticated %}w-100{% endif %}">

            <!-- ✅ Messages Flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="container mt-3">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>

    </main>

    {% include "footer.html" %}
</body>